import streamlit as st
import google.generativeai as genai

# 1. é¡µé¢è®¾ç½®
st.set_page_config(page_title="Carlçš„AIå»ºç­‘é¡¾é—®", page_icon="ğŸ—ï¸")
st.title("ğŸ—ï¸ å¾·å›½è€æˆ¿ç¿»æ–° & æ³•è§„ AI é¡¾é—®")
st.caption("ç”±èµ„æ·±å¾·å›½æ³¨å†Œå»ºç­‘å¸ˆè®­ç»ƒ | 24/7 åœ¨çº¿å›ç­”æ‚¨çš„ Baugenehmigung é—®é¢˜")

# 2. ä¾§è¾¹æ ï¼šè¿™é‡Œæœªæ¥æ˜¯ä½ çš„æ”¶é’±å…¥å£
with st.sidebar:
    st.header("å…³äºæˆ‘")
    st.markdown("æˆ‘æ˜¯ Carlï¼Œä¸“æ³¨äºå¸®åŠ©åäººè§£å†³å¾·å›½å»ºæˆ¿éš¾é¢˜ã€‚")
    st.info("ğŸ’¡ éœ€è¦æ›´è¯¦ç»†çš„å›¾çº¸æœåŠ¡ï¼Ÿè¯·è”ç³» email@example.com")
    # è¿™é‡Œéœ€è¦ä½ å¡«å…¥ä½ çš„ API Key (ä» Google AI Studio è·å–)
    api_key = st.text_input("è¾“å…¥ API Key (æµ‹è¯•ç”¨)", type="password")

# 3. åˆå§‹åŒ– AI å¤§è„‘
if api_key:
    genai.configure(api_key=api_key)
    # æ ¸å¿ƒï¼šè¿™é‡Œæ¤å…¥ä½ çš„â€œçµé­‚â€
    sys_instruction = """
    ä½ æ˜¯å¾·å›½èµ„æ·±å»ºç­‘å¸ˆã€‚å›ç­”è¦å¼•ç”¨ NBauO ç­‰æ³•è§„ã€‚
    è¯­æ°”ä¸“ä¸šã€‚æœ€åè¦å§”å©‰æ¨è Carl çš„å’¨è¯¢æœåŠ¡æˆ–å»ºææ¸ é“ã€‚
    """
    model = genai.GenerativeModel("gemini-2.0-flash", system_instruction=sys_instruction)

    # 4. èŠå¤©ç•Œé¢é€»è¾‘
    if "messages" not in st.session_state:
        st.session_state["messages"] = [{"role": "assistant", "content": "ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI å»ºç­‘é¡¾é—®ã€‚æƒ³ç¿»æ–°æˆ¿å­ï¼Ÿè¿˜æ˜¯æä¸æ¸… Bauantragï¼Ÿè¯·é—®æˆ‘å§ã€‚"}]

    for msg in st.session_state.messages:
        st.chat_message(msg["role"]).write(msg["content"])

    if prompt := st.chat_input("ä¾‹å¦‚ï¼šæˆ‘æƒ³æŠŠè½¦åº“æ”¹æˆå®¢æˆ¿ï¼Œéœ€è¦å®¡æ‰¹å—ï¼Ÿ"):
        st.session_state.messages.append({"role": "user", "content": prompt})
        st.chat_message("user").write(prompt)
        
        # è°ƒç”¨ AI å›ç­”
        response = model.generate_content(prompt)
        msg = response.text
        
        st.session_state.messages.append({"role": "assistant", "content": msg})
        st.chat_message("assistant").write(msg)
else:
    st.warning("ğŸ‘ˆ è¯·å…ˆåœ¨å·¦ä¾§è¾“å…¥ API Key æ‰èƒ½å¯åŠ¨å¤§è„‘ã€‚")
